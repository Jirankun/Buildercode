<!-- generate-code.html -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üîë Dapatkan Kode Akses Album</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
    .box { max-width: 500px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #2c3e50; }
    input, button { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; }
    button { background: #3498db; color: white; font-weight: bold; cursor: pointer; }
    button:hover { background: #2980b9; }
    #result { margin-top: 15px; padding: 12px; background: #e8f4fc; border-radius: 6px; font-family: monospace; word-break: break-all; }
    .small-btn { width: auto; padding: 6px 10px; margin-left: 8px; display: inline-block; vertical-align: middle; font-size: 13px; border-radius: 6px; }
    .info { font-size: 13px; color: #7f8c8d; margin-top: 10px; }
  </style>
</head>
<body>
  <div class="box">
    <h2>üîë Dapatkan Kode Akses</h2>
    <p>Masukkan nama lengkap dan password rahasia yang diberikan.</p>
    
    <input type="text" id="name" placeholder="Nama Lengkap Anda">
    <datalist id="nameList"></datalist>
    <input type="password" id="password" placeholder="Password Rahasia">
    <button onclick="generateCode()">Buat Kode Akses</button>
    
    <div id="result">
      <div id="codeWrapper">
        <strong id="codeLabel">Kode akan muncul di sini...</strong>
        <span id="codeText" style="display:block; margin-top:8px;"></span>
      </div>
      <button id="copyBtn" class="small-btn" style="display:none">Salin</button>
    </div>
    <div class="info">
      ‚ÑπÔ∏è Salin kode ini, lalu masukkan di halaman album utama.
    </div>
  </div>

  <script>
    // Fungsi hashing sederhana
    function hashPass(pass) {
      let h = 0;
      for (let c of pass) h = Math.imul(h ^ c.charCodeAt(), 1540483477) >>> 0;
      return h;
    }

    const CHARS = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';

    // Password bersama (dipakai juga untuk memunculkan opsi nama)
    const SHARED_SECRET = "tkjone";

    // Daftar nama yang akan muncul sebagai opsi ketika password cocok
    const NAMES = [
            "Abiyu Anugrah",
            "Aktsar Hakim Nst",
            "Amalia Safitri",
            "Amir Hamzah",
            "Asra Bilhuda",
            "Eli Zahara",
            "Ezyla Aziz Zeira",
            "Fadel Muhammad Rezki",
            "Faizul Adzimi",
            "Faldho Adzani",
            "Fitria Mulia",
            "Galang Luqmanul Hakim",
            "Hafif Mabrur",
            "Kasifa Rahmah",
            "Keysa Putri Ramadani",
            "M. Rafiki Rasli",
            "Muhammad Hibban Aulia",
            "Muhammad Yudha Pratama",
            "Najia Atika Sahira",
            "Najwa Asyifa",
            "Rafi Idham",
            "Ranti Amelia",
            "Rasima Handayani",
            "Reviansyah",
            "Reza Ardiansyah",
            "Sakinah Khanza",
            "Salimah",
            "Salsa Bila",
            "Susi Saskia",
            "Syah Ratul Faiza",
            "Thalita Syafa Harahap",
            "Tonius Nduru",
            "Yennisa Mulia",
            "Yuda Setriawan",
            "Zhyllan Fyllah"
    ];

    function textToCode(text, pass) {
      const seed = hashPass(pass);
      let out = '';
      for (let i = 0; i < text.length; i++) {
        const code = text.charCodeAt(i);
        const offset = (seed + i * 41) % CHARS.length;
        const val = (code + offset) % 256;
        out += CHARS[Math.floor(val / CHARS.length)] + CHARS[val % CHARS.length];
      }
      return out.match(/.{1,5}/g)?.join('-') || out;
    }

    function generateCode() {
      const name = document.getElementById('name').value.trim();
      const pass = document.getElementById('password').value;
      const res = document.getElementById('result');
      const codeLabel = document.getElementById('codeLabel');
      const codeText = document.getElementById('codeText');
      const copyBtn = document.getElementById('copyBtn');
      
      if (!name || !pass) {
        codeLabel.textContent = '‚ö†Ô∏è Nama dan password wajib diisi!';
        codeText.textContent = '';
        copyBtn.style.display = 'none';
        return;
      }

      if (pass !== SHARED_SECRET) {
        codeLabel.textContent = '‚ùå Password salah! Tanya ke pemilik album.';
        codeText.textContent = '';
        copyBtn.style.display = 'none';
        return;
      }

      const kode = textToCode(name, SHARED_SECRET);
      codeLabel.innerHTML = '<strong>Kode Akses Anda:</strong>';
      codeText.textContent = kode;
      copyBtn.style.display = 'inline-block';
    }

    // --- Fungsi copy ke clipboard dan feedback ---
    function copyCode() {
      const codeText = document.getElementById('codeText');
      const copyBtn = document.getElementById('copyBtn');
      const text = codeText.textContent || '';
      if (!text) return;

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(() => {
          const prev = copyBtn.textContent;
          copyBtn.textContent = 'Disalin!';
          setTimeout(() => copyBtn.textContent = prev, 1800);
        }).catch(() => fallbackCopy(text, copyBtn));
      } else {
        fallbackCopy(text, copyBtn);
      }
    }

    function fallbackCopy(text, copyBtn) {
      // fallback untuk browser lama
      const ta = document.createElement('textarea');
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      try {
        document.execCommand('copy');
        const prev = copyBtn.textContent;
        copyBtn.textContent = 'Disalin!';
        setTimeout(() => copyBtn.textContent = prev, 1800);
      } catch (e) {
        alert('Gagal menyalin. Silakan salin secara manual.');
      }
      document.body.removeChild(ta);
    }

    document.getElementById('copyBtn').addEventListener('click', copyCode);

    // --- Fungsi untuk mem-populasi datalist nama hanya jika password cocok ---
    const passwordInput = document.getElementById('password');
    const nameInput = document.getElementById('name');
    const nameList = document.getElementById('nameList');

    function clearNameOptions() {
      while (nameList.firstChild) nameList.removeChild(nameList.firstChild);
    }

    function populateNameOptions() {
      clearNameOptions();
      for (const n of NAMES) {
        const opt = document.createElement('option');
        opt.value = n;
        nameList.appendChild(opt);
      }
    }

    function updateNameOptions() {
      if (passwordInput.value === SHARED_SECRET) {
        // isi dan aktifkan daftar opsi
        populateNameOptions();
        nameInput.setAttribute('list', 'nameList');
      } else {
        // kosongkan opsi dan nonaktifkan
        clearNameOptions();
        nameInput.removeAttribute('list');
      }
    }

    passwordInput.addEventListener('input', updateNameOptions);
    // inisialisasi
    updateNameOptions();
  </script>
</body>
</html>
